"use strict";var alsglance=alsglance||{};alsglance.charts=alsglance.charts||{muscleChartId:1,removeInvalidBins:function(n){return{all:function(){return n.all().filter(function(n){return n.value>0})}}},removeOverlapedAxisTicks:function(n){for(var r,i,t=0;t<n.length;t++)if(r=n[t],i=n[t+1],r&&i&&r.getBoundingClientRect&&i.getBoundingClientRect)while(r.getBoundingClientRect().right>i.getBoundingClientRect().left)if(d3.select(i).remove(),t++,i=n[t+1],!i)break},setBehaviour:function(){alsglance.charts.replaceControlsBehaviour();$(window).resize(function(){this.resizeTO&&clearTimeout(this.resizeTO);this.resizeTO=setTimeout(function(){$(this).trigger("resizeEnd")},500)});$(window).bind("resizeEnd",function(){alsglance.charts.resizeAll()})},addXAxis:function(n,t){n!=null&&($("#chart"+n.__dcFlag__).remove(),n.svg().append("text").attr("id","chart"+n.__dcFlag__).attr("class","x-axis-label x-label").attr("text-anchor","middle").attr("x",n.width()/2).attr("y",n.height()).text(t))},turnOffControls:function(n){return function(){var i=n.root()[0][0],t;return i!=null&&(t=i.parentNode.parentNode,d3.select(t).selectAll(".reset").style("display","none"),d3.select(t).selectAll(".filter").style("display","none").text(n.filter())),n}},turnOnControls:function(n){return function(){var i=n.root()[0][0],t,r;return i!=null&&(t=i.parentNode.parentNode,r=n.filterPrinter(),d3.select(t).selectAll(".reset").style("display",null),d3.select(t).selectAll(".filter").text(r(n.filters())).style("display",null)),n}},replaceControlsBehaviour:function(){for(var n,t=0;t<dc.chartRegistry.list().length;t++)n=dc.chartRegistry.list()[t],n.turnOnControls=alsglance.charts.turnOnControls(n),n.turnOffControls=alsglance.charts.turnOffControls(n)},resize:function(n){var i,r,t,u,f;n!=null&&(i=$("#"+n.anchorName()).parent(),r=i.width(),r!=null)&&(n.hasOwnProperty("rangeChart")&&(u=n.rangeChart(),u!=null&&(t=$("#"+n.anchorName()).parent().parent().height()-u.height(),n.height(t),$("#"+n.anchorName()).height(t),$("#"+n.anchorName()).parent().height(t))),t=i.height(),f=i.children().size(),n.width(r),f==1&&n.height(t),n.hasOwnProperty("radius")&&(n.radius(Math.min(r,t)/2.5),n.innerRadius(n.radius()/2)))},resizeAll:function(){for(var t,n=0;n<dc.chartRegistry.list().length;n++)t=dc.chartRegistry.list()[n],t.transitionDuration(0),alsglance.charts.resize(t);for(dc.renderAll(),n=0;n<dc.chartRegistry.list().length;n++)t=dc.chartRegistry.list()[n],t.transitionDuration(500);alsglance.charts.emgChart!=null&&alsglance.charts.emgChart.resize()}};alsglance.presentation=alsglance.presentation||{arrangePanels:function(n){for(var r,i=alsglance.presentation.panelsPosition(),t=0;t<n.length;t++)r=n[t],r!=i[t]&&($("#"+i[t]).swap($("#"+r)),t=0,i=alsglance.presentation.panelsPosition())},panelsPosition:function(){return $("div.box").not(".no-drop").map(function(){return this.id}).get()},makePanelsDraggable:function(){jQuery.fn.swap=function(n){n=jQuery(n)[0];var i=this[0],t=i.parentNode.insertBefore(document.createTextNode(""),i);return n.parentNode.insertBefore(i,n),t.parentNode.insertBefore(n,t),t.parentNode.removeChild(t),this};$("div.box").not(".no-drop").attr("id",function(n){return"draggable_"+n}).draggable({revert:!0,zIndex:2e3,cursor:"crosshair",handle:".box-name",opacity:.8}).droppable({tolerance:"pointer",drop:function(n,t){var i=t.draggable,r=$(this);i.swap(r);setTimeout(function(){var n=r.find("[id^=map-]"),t=i.find("[id^=map-]");t.length>0||n.length>0?(t.resize(),n.resize()):(i.resize(),r.resize(),i.css("width",""),r.css("width",""),i.css("height",""),r.css("height",""),alsglance.charts.resizeAll())},50);setTimeout(function(){i.find("[id^=map-]").resize();r.find("[id^=map-]").resize()},250)}})},bindButtonEvents:function(){$("#reset").click(function(){alsglance.dashboard.patient.reset();alsglance.presentation.arrangePanels(["draggable_0","draggable_1","draggable_2","draggable_3","draggable_4"]);alsglance.charts.resizeAll();analytics.logUiEvent("reset","Patient","dashboard")});$("#save").click(function(){alsglance.dashboard.patient.saveSettings();analytics.logUiEvent("save","Patient","dashboard")});$("#saveOptions").click(function(){alsglance.dashboard.settings.showPredictions=$("#showPredictions").is(":checked");alsglance.dashboard.settings.showFailureThreshold=$("#showFailureThresHold").is(":checked");alsglance.dashboard.settings.predictionBackLog=parseInt($("input[name=predictionBacklog]:checked","#aucForm").val());$("#aucOptions").modal("hide");alsglance.dashboard.settings.atThreshold=parseFloat($("#AT_Threshold").val());alsglance.dashboard.settings.scmThreshold=parseFloat($("#SCM_Threshold").val());alsglance.dashboard.settings.fcrThreshold=parseFloat($("#FCR_Threshold").val());alsglance.dashboard.settings.envelopeWindowSize=parseInt($("#envelopeWindowSize").val());alsglance.dashboard.patient.saveSettings();alsglance.dashboard.patient.loadFacts()});$("#saveEMGOptions").click(function(){$("#emgOptions").modal("hide");alsglance.dashboard.settings.envelopeWindowSize=parseInt($("#envelopeWindowSize").val());alsglance.dashboard.patient.saveSettings();alsglance.dashboard.patient.renderEmg()});$.each($("#muscles .btn"),function(n,t){var i=$(t).attr("id");$(t).click(i,function(){alsglance.dashboard.patient.filterMuscle(i);dc.redrawAll();analytics.logUiEvent("filterMuscle","Patient","dashboard")})})},showPatientsHelpButton:function(){$("#patients_filter").attr("data-position","bottom");$("#patients_filter").attr("data-step","2");$("#patients_filter").attr("data-intro",alsglance.resources.patientsTip2);$("#helpPlaceHolder").html('<a href="javascript:void(0);" onclick="javascript:alsglance.presentation.showHelp(\'Patients\');">'+alsglance.resources.help+"<\/a>")},showPatientHelpButton:function(){$("#helpPlaceHolder").html('<a href="javascript:void(0);" onclick="javascript:alsglance.presentation.showHelp(\'Patient\');">'+alsglance.resources.help+"<\/a>")},showHelp:function(n){introJs().start();analytics.logUiEvent("showHelp",n,"navbar")},showLoadingDialog:function(n){var t=n('<div class="modal" data-backdrop="false" data-keyboard="false" tabindex="-1" role="dialog" aria-hidden="true" style="padding-top:15%; overflow-y:visible;"><div class="modal-dialog modal-m"><div class="modal-content"><div class="modal-header"><h6 style="margin:0;"><\/h6><\/div><div class="modal-body"><div class="progress progress-striped active" style="margin-bottom:0; height:16px;"><div class="progress-bar" style="width: 100%"><\/div><\/div><\/div><\/div><\/div><\/div>');return{show:function(i,r){var u=n.extend({dialogSize:"m",progressType:""},r);typeof i=="undefined"&&(i="Loading");typeof r=="undefined"&&(r={});t.find(".modal-dialog").attr("class","modal-dialog").addClass("modal-"+u.dialogSize);t.find(".progress-bar").attr("class","progress-bar");u.progressType&&t.find(".progress-bar").addClass("progress-bar-"+u.progressType);t.find("h6").html(alsglance.resources.loadingMessage+"<br/><br/><b>"+i+"<\/b>");t.modal();analytics.logUiEvent("viewResume","Patient","dashboard")},hide:function(){t.modal("hide")}}}(jQuery)};alsglance.dashboard=alsglance.dashboard||{};alsglance.dashboard.patients=alsglance.dashboard.patients||{loadFacts:function(n,t){$.when(alsglance.apiClient.get("DimPatient?$select=Keycol,PatientId,BornOn,DiagnosedOn,Name,Sex")).then(function(i){alsglance.dashboard.patients.load(i,n,t);alsglance.dashboard.patients.dataTable=$("#patients").dataTable({language:alsglance.resources.dataTables,order:[[3,"asc"]],aaData:alsglance.dashboard.patients.sexDimension.top(Infinity),dom:'<"top"f<"clear">>rt<"col-sm-offset-4"p>',bLengthChange:!1,bSort:!0,bInfo:!1,bAutoWidth:!1,bDeferRender:!0,bDestroy:!0,aoColumns:[{mData:"PatientId",sDefaultContent:""},{mData:"BornOn",sDefaultContent:""},{mData:"DiagnosedOn",sDefaultContent:""},{mData:"Name",sDefaultContent:""},{mData:"Sex",sDefaultContent:""},{mData:"Resume",sDefaultContent:""}]});alsglance.presentation.showPatientsHelpButton();alsglance.charts.setBehaviour();alsglance.charts.resizeAll();alsglance.charts.aucBubbleChart.render()})},load:function(n,t,i){var r,u,f;alsglance.charts.aucBubbleChart=alsglance.charts.aucBubbleChart||dc.bubbleChart("#aucBubbleChart");r=d3.format(".5f");n=n.value;n.forEach(function(n){var t=new Date;t.setISO8601(n.BornOn);n.Age=moment().diff(t,"years");n.Resume='<a id="resume" href="javascript:void(0);" onclick="javascript:alsglance.presentation.showLoadingDialog.show(\''+n.Name+"');window.location='"+alsglance.resources.patientLink+n.Id+'\'" data-step="3" data-intro="'+alsglance.resources.patientsTip3+'" data-position=\'left\'> <span id="resume" class="fa fa-eye"><\/span><\/a>'});u=crossfilter(n);alsglance.dashboard.patients.sexDimension=u.dimension(function(n){return n.Sex});f=alsglance.dashboard.patients.sexDimension.group().reduce(function(n,t){return++n.count,n.sumAge+=t.Age,n.avgAge=n.sumAge/n.count,n},function(n,t){return--n.count,n.sumAge-=t.Age,n.avgAge=n.count?n.sumAge/n.count:0,n},function(){return{sumAge:0,avgAge:0,count:0}});alsglance.charts.aucBubbleChart.transitionDuration(1500).margins({top:10,right:50,bottom:40,left:50}).dimension(alsglance.dashboard.patients.sexDimension).group(f).colors(["rgb(49,130,189)","rgb(247,104,161)"]).colorAccessor(function(n){return n.key=="M"?0:1}).keyAccessor(function(n){return n.value.avgAge}).valueAccessor(function(n){return n.value.count}).radiusValueAccessor(function(n){return n.value.avgAge}).maxBubbleRelativeSize(.7).x(d3.scale.linear().domain([t,i])).y(d3.scale.linear().domain([-100,100])).r(d3.scale.linear().domain([0,4e3])).elasticY(!0).yAxisPadding(20).xAxisPadding(50).renderHorizontalGridLines(!0).renderVerticalGridLines(!0).xAxisLabel(alsglance.resources.patientsXAxisLabel).yAxisLabel(alsglance.resources.patientsYAxisLabel).renderLabel(!0).label(function(n){return n.key}).renderTitle(!0).title(function(n){return[n.key,alsglance.resources.patientsYAxisLabel+": "+n.value.count,alsglance.resources.patientsXAxisLabel+": "+r(n.value.avgAge)].join("\n")}).on("filtered",function(){dc.events.trigger(function(){var n=alsglance.dashboard.patients.sexDimension.top(Infinity);alsglance.dashboard.patients.dataTable.fnClearTable();alsglance.dashboard.patients.dataTable.fnAddData(n);alsglance.dashboard.patients.dataTable.fnDraw()})});dc.renderAll();$(".loading").remove()}};alsglance.dashboard.patient=alsglance.dashboard.patient||{maxDate:function(){return new Date(alsglance.dashboard.patient.yearMax+(alsglance.dashboard.settings.showPredictions?1:0),11,31)},loadSettings:function(n){alsglance.dashboard.settings=alsglance.dashboard.settings||n;alsglance.dashboard.settings.layout=alsglance.dashboard.settings.layout||[];alsglance.dashboard.settings.envelopeWindowSize==null&&(alsglance.dashboard.settings.showPredictions=alsglance.dashboard.settings.showFailureThreshold=!0,alsglance.dashboard.settings.atThreshold=alsglance.dashboard.settings.fcrThreshold=.018,alsglance.dashboard.settings.scmThreshold=.013,alsglance.dashboard.settings.envelopeWindowSize=15);$("#showPredictions").prop("checked",alsglance.dashboard.settings.showPredictions);$("#showFailureThresHold").prop("checked",alsglance.dashboard.settings.showFailureThreshold);$("#AT_Threshold").val(alsglance.dashboard.settings.atThreshold);$("#FCR_Threshold").val(alsglance.dashboard.settings.fcrThreshold);$("#SCM_Threshold").val(alsglance.dashboard.settings.scmThreshold);$("#envelopeWindowSize").val(alsglance.dashboard.settings.envelopeWindowSize);alsglance.dashboard.settings.predictionBackLog==999?$("#all").prop("checked",!0):alsglance.dashboard.settings.predictionBackLog==12?$("#year").prop("checked",!0):(alsglance.dashboard.settings.predictionBackLog=6,$("#6months").prop("checked",!0));alsglance.presentation.arrangePanels(alsglance.dashboard.settings.layout)},loadFacts:function(){$.when(alsglance.apiClient.get("Facts?$select=AUC,TimeHour,TimeTimeOfDay,DateDate,DateYear,DateMonthName,DateQuarter,MuscleAbbreviation,PatientName&$filter=PatientId eq "+alsglance.dashboard.patient.id)).then(function(n){n=alsglance.dashboard.patient.addPredictions(n.value);alsglance.dashboard.patient.load(n);colorbrewer.showColorSchemeButton(alsglance.dashboard.settings.colorScheme);alsglance.charts.setBehaviour();alsglance.charts.resizeAll();alsglance.dashboard.patient.reset();alsglance.dashboard.patient.applyFilters(alsglance.dashboard.settings["P"+alsglance.dashboard.patient.id])})},saveSettings:function(){for(var t,i,n,u=[],r=0;r<dc.chartRegistry.list().length;r++)for(t=dc.chartRegistry.list()[r],i=0;i<t.filters().length;i++)u.push({ChartID:t.chartID(),Filter:t.filters()[i]});alsglance.dashboard.settings["P"+alsglance.dashboard.patient.id]=u;alsglance.dashboard.settings.layout=alsglance.presentation.panelsPosition();alsglance.dashboard.settings.colorScheme=colorbrewer.selectedScheme;n={};n.UserId=alsglance.dashboard.userId;n.ApplicationId=alsglance.applicationId;n.Value=JSON.stringify(alsglance.dashboard.settings);$.when(alsglance.apiClient.post("ApplicationSettings",JSON.stringify(n))).then(function(){toastr.success(alsglance.resources.saveMessage,"ALS Glance")})},applyFilters:function(n){var t,i,r,u,f;if(n!=null&&n.length!=0){for(r=0;r<n.length;r++)t=n[r].ChartID,i=n[r].Filter,t==alsglance.charts.muscleChartId?alsglance.dashboard.patient.filterMuscle(i[0]):t==6?(dc.chartRegistry.list()[t-1].filterAll(),dc.chartRegistry.list()[t-1].filter(dc.filters.RangedFilter(moment(i[0]).valueOf(),moment(i[1]).valueOf()))):t==3&&(dc.chartRegistry.list()[t-1].filterAll(),dc.chartRegistry.list()[t-1].filter(dc.filters.RangedFilter(i[0],i[1])));for(u=0;u<n.length;u++)if(t=n[u].ChartID,t!=alsglance.charts.muscleChartId&&t!=3&&t!=6){if(i=n[u].Filter,f=dc.chartRegistry.list()[t-1],f==null)continue;f.filter(i)}dc.redrawAll()}},reset:function(){alsglance.dashboard.patient.timeOfDay=null;alsglance.dashboard.patient.lastUrl=null;dc.filterAll();alsglance.dashboard.patient.datePicker();alsglance.dashboard.patient.filterMuscle("AT");dc.redrawAll();alsglance.charts.emgChart!=null&&alsglance.charts.emgChart.resetZoom()},filterMuscle:function(n){$("#AT").removeClass("active");$("#FCR").removeClass("active");$("#SCM").removeClass("active");$("#"+n).addClass("active");alsglance.charts.muscleChart.filterAll();alsglance.charts.muscleChart.filter([n])},addPredictions:function(n){var t,s,r,h,f,e,a,o,u;if(!alsglance.dashboard.settings.showFailureThreshold&&!alsglance.dashboard.settings.showPredictions)return n;t=[];s=moment(n[n.length-1].DateDate);n.forEach(function(n){s.diff(n.DateDate,"months")<=alsglance.dashboard.settings.predictionBackLog&&(t[n.MuscleAbbreviation]==null&&(t[n.MuscleAbbreviation]=[]),t[n.MuscleAbbreviation][n.TimeTimeOfDay]==null&&(t[n.MuscleAbbreviation][n.TimeTimeOfDay]=[]),t[n.MuscleAbbreviation][n.TimeTimeOfDay].push([new Date(n.DateDate).getTime(),n.AUC]))});for(r in t){h=r=="FCR"?alsglance.dashboard.settings.fcrThreshold:r=="SCM"?alsglance.dashboard.settings.scmThreshold:alsglance.dashboard.settings.atThreshold;for(f in t[r]){var c=t[r][f],l=regression("linear",c).equation,i=moment(c[0][0]),v=moment(alsglance.dashboard.patient.maxDate()).diff(i,"months");for(e=1;e<v;e++)i=i.add(1,"months"),a=i.valueOf(),o={DateDate:i.format("YYYY-MM-DD HH:mm"),AUC:l[0]*a+l[1],DateMonthName:i.format("MMMM"),DateYear:parseInt(i.format("YYYY")),DateQuarter:i.quarter(),PatientName:alsglance.resources.prediction,MuscleAbbreviation:r,TimeTimeOfDay:f},alsglance.dashboard.settings.showFailureThreshold&&(u=jQuery.extend({},o),u.PatientName=alsglance.resources.muscleFailure,u.AUC=h,n.push(u)),alsglance.dashboard.settings.showPredictions&&n.push(o)}}return n},loadEmg:function(){if(alsglance.dashboard.patient.muscle!=null){var t=function(n){for(var t=null,i=0;i<n.length;i++)t=(t?t+" or ":"")+"Time/TimeOfDay eq '"+n[i]+"'";return" and ("+t+")"},n="Fact?$top=1&$select=EMG&$expand=EMG($select=Data)&$filter=Patient/Keycol%20eq%20"+alsglance.dashboard.patient.id+" and EMG ne null  and Muscle/Acronym eq '"+alsglance.dashboard.patient.muscle+"' "+(alsglance.dashboard.patient.timeOfDay!=null?t(alsglance.dashboard.patient.timeOfDay):"")+(alsglance.dashboard.patient.endDate!=null?" and Date/Date le "+alsglance.dashboard.patient.endDate.format("YYYY-MM-DDTHH:mm")+"%2B00:00&$orderby=Date/Date desc":"");n!=alsglance.dashboard.patient.lastUrl&&(alsglance.dashboard.patient.lastUrl=n,$.when(alsglance.apiClient.get(n)).then(function(n){var t=n.value;alsglance.charts.emgData=null;t!=null&&t.length>0&&(alsglance.charts.emgData=JSON.parse(t[0].EMG.Data));alsglance.dashboard.patient.renderEmg();$(".loadingEmg").remove()}))}},toggleEmgEnvelope:function(){alsglance.dashboard.settings.envelopeEmg=!alsglance.dashboard.settings.envelopeEmg},renderEmg:function(){var u=function(n,t,i){var u=0,r;for(i=Math.min(i,n.length),r=t;r<i;r++)u+=parseInt(Math.abs(n[r][1]),10);return u/(i-t)},t=alsglance.charts.emgData,i,r,n;if(alsglance.dashboard.settings.envelopeEmg&&t!=null){for(i=[],n=0;n<t.length;n++)r=Math.min(alsglance.dashboard.settings.envelopeWindowSize,t.length-alsglance.dashboard.settings.envelopeWindowSize,Math.abs(alsglance.dashboard.settings.envelopeWindowSize-n)),i.push([n,u(t,n,n+r-1)]);t=i}alsglance.charts.emgChart=new Dygraph(document.getElementById("emgChart"),t,{labels:[alsglance.resources.time,"µV"],xlabel:alsglance.resources.time,legend:"true",colors:[colorbrewer.schemes[colorbrewer.selectedScheme][colorbrewer.numClasses][3]],gridLineColor:"rgb(204, 204, 204)",labelsDivStyles:{textAlign:"right"}})},load:function(n){var r,i;alsglance.charts.muscleChart=alsglance.charts.muscleChart||dc.pieChart("#muscleChart");alsglance.charts.quarterChart=alsglance.charts.quarterChart||dc.pieChart("#quarterChart");alsglance.charts.timeHourChart=alsglance.charts.timeHourChart||dc.barChart("#timeHourChart");alsglance.charts.timeOfDayChart=alsglance.charts.timeOfDayChart||dc.rowChart("#timeOfDayChart");alsglance.charts.aucSeriesChart=alsglance.charts.aucSeriesChart||dc.seriesChart("#predictionSeriesChart");alsglance.charts.dateRangeChart=alsglance.charts.dateRangeChart||dc.barChart("#dateRangeChart");alsglance.dashboard.patient.datePicker=function(){var n=moment("01-01-"+alsglance.dashboard.patient.yearMin,"MM-DD-YYYY"),t=moment(alsglance.dashboard.patient.maxDate());alsglance.dashboard.patient.endDate=t;$("#reportrange span").html(n.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"));$("#reportrange").daterangepicker({format:"MM/DD/YYYY",startDate:n,endDate:moment(),minDate:n,maxDate:t,showDropdowns:!0,showWeekNumbers:!1,timePicker:!1,timePickerIncrement:1,timePicker12Hour:!0,ranges:{"Last 30 Days":[moment().subtract(29,"days"),moment()],"This Month":[moment().startOf("month"),moment().endOf("month")],"Last Month":[moment().subtract(1,"month").startOf("month"),moment().subtract(1,"month").endOf("month")],"Last Year":[moment().subtract(1,"year"),moment()]},opens:"left",drops:"down",buttonClasses:["btn","btn-sm"],applyClass:"btn-primary",cancelClass:"btn-default",separator:" to ",locale:{applyLabel:"Submit",cancelLabel:"Cancel",fromLabel:"From",toLabel:"To",customRangeLabel:"Custom",daysOfWeek:["Su","Mo","Tu","We","Th","Fr","Sa"],monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],firstDay:1}},function(n,t){$("#reportrange span").html(n.format("MMMM D, YYYY")+" - "+t.format("MMMM D, YYYY"));alsglance.charts.dateRangeChart.filterAll();alsglance.charts.dateRangeChart.filter(dc.filters.RangedFilter(n.valueOf(),t.valueOf()));dc.redrawAll();analytics.logUiEvent("filterDates","Patient","dashboard")})};r=d3.time.format("%Y/%m/%d");i=d3.format(".0f");n.forEach(function(n){var t=new Date;t.setISO8601(n.DateDate);n.DateDate=t;n.DateMonthInYear=d3.time.month(n.DateDate)});var t=crossfilter(n),l=t.groupAll(),a=t.dimension(function(n){return n.DateDate}),u=t.dimension(function(n){return n.DateMonthInYear}),v=u.group().reduceSum(function(n){return n.AUC}),f=t.dimension(function(n){return n.MuscleAbbreviation}),y=f.group().reduceCount();alsglance.charts.muscleChart.dimension(f).group(y).on("filtered",function(n){var t=n.filters();t.length>0&&(alsglance.dashboard.patient.muscle=t[0],alsglance.dashboard.patient.loadEmg())});var e=t.dimension(function(n){return n.TimeHour}),p=e.group(),o=t.dimension(function(n){return n.TimeTimeOfDay}),w=o.group(),s=t.dimension(function(n){return alsglance.resources.quarterPrefix+n.DateQuarter}),b=s.group();alsglance.charts.quarterChart.radius(90).innerRadius(50).dimension(s).group(b);alsglance.charts.timeOfDayChart.group(w).dimension(o).label(function(n){return n.key}).on("renderlet.axis",function(n){alsglance.charts.addXAxis(n,alsglance.resources.measurements)}).on("filtered",function(n){var t=n.filters();alsglance.dashboard.patient.timeOfDay=t.length>0?t:null;alsglance.dashboard.patient.loadEmg()}).elasticX(!0).xAxis().ticks(4);alsglance.charts.timeHourChart.dimension(e).group(p).elasticY(!0).centerBar(!0).gap(2).round(dc.round.floor).alwaysUseRounding(!0).x(d3.scale.linear().domain([0,23])).yAxisLabel(alsglance.resources.measurements).renderHorizontalGridLines(!0).on("renderlet.axis",function(){alsglance.charts.removeOverlapedAxisTicks($("#timeHourChart .axis.x").find(".tick"))}).filterPrinter(function(n){var t=n[0];return""+(i(t[0])+"h -> "+i(t[1])+"h")});alsglance.charts.timeHourChart.xAxis().tickFormat(function(n){return n+"h"});alsglance.charts.timeHourChart.yAxis().ticks(6);var h=t.dimension(function(n){return[n.PatientName,n.DateDate,n.MuscleAbbreviation,n.TimeTimeOfDay]}),k=h.group().reduceSum(function(n){return+n.AUC}),d=d3.locale({decimal:",",thousands:".",grouping:[3],currency:["€",""],dateTime:"%a %b %e %X %Y",date:"%d-%m-%Y",time:"%H:%M:%S",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:alsglance.resources.shortDays,months:alsglance.resources.months,shortMonths:alsglance.resources.shortMonths}),c=d.timeFormat.multi([["%H:%M",function(n){return n.getMinutes()}],["%H:%M",function(n){return n.getHours()}],["%a %d",function(n){return n.getDay()&&n.getDate()!=1}],["%b %d",function(n){return n.getDate()!=1}],["%B",function(n){return n.getMonth()}],["%Y",function(){return!0}]]);alsglance.charts.aucSeriesChart.margins({top:20,right:30,bottom:20,left:60}).x(d3.time.scale().domain([new Date(alsglance.dashboard.patient.yearMin,0,1),alsglance.dashboard.patient.maxDate()])).y(d3.scale.linear().domain([.009,.03])).brushOn(!1).dimension(h).group(alsglance.charts.removeInvalidBins(k)).rangeChart(alsglance.charts.dateRangeChart).seriesAccessor(function(n){return n.key[0]}).keyAccessor(function(n){return n.key[1]}).valueAccessor(function(n){return+n.value}).legend(dc.legend().x(80).y(10).itemHeight(13).gap(5).legendWidth(170).itemWidth(170)).title(function(n){return r(n.key[1])+":\n"+n.value}).on("renderlet.axis",function(){alsglance.charts.removeOverlapedAxisTicks($("#predictionSeriesChart .axis.x").find(".tick"))});alsglance.charts.aucSeriesChart.xAxis().tickFormat(c);alsglance.charts.dateRangeChart.height(50).mouseZoomable(!0).margins({top:0,right:50,bottom:20,left:60}).dimension(u).group(alsglance.charts.removeInvalidBins(v)).centerBar(!0).gap(1).x(d3.time.scale().domain([new Date(alsglance.dashboard.patient.yearMin,0,1),alsglance.dashboard.patient.maxDate()])).elasticY(!0).round(d3.time.month.round).alwaysUseRounding(!0).xUnits(d3.time.months).on("renderlet.axis",function(){alsglance.charts.removeOverlapedAxisTicks($("#dateRangeChart .axis.x").find(".tick"));$("#dateRangeChart").height(50)}).on("filtered",function(n){var i=n.filters(),t;i.length>0?(t=i[0],alsglance.dashboard.patient.endDate=moment(t[1]),$("#reportrange span").html(moment(t[0]).format("MMMM D, YYYY")+" - "+alsglance.dashboard.patient.endDate.format("MMMM D, YYYY"))):alsglance.dashboard.patient.endDate=moment(alsglance.dashboard.patient.maxDate());alsglance.dashboard.patient.loadEmg()});alsglance.charts.dateRangeChart.xAxis().tickFormat(c);dc.dataCount("#dc-data-count").dimension(t).group(l).html({some:alsglance.resources.someSelectedMessage,all:alsglance.resources.allSelectedMessage});dc.dataTable("#dc-data-table").dimension(a).group(function(n){return n.DateYear+"/"+n.DateMonthName}).size(100).columns([{label:alsglance.resources.date,format:function(n){return moment(n.DateDate).format("YYYY-MM-DD")}},{label:alsglance.resources.name,format:function(n){return n.PatientName}},{label:alsglance.resources.timeOfDay,format:function(n){return n.TimeTimeOfDay}},{label:alsglance.resources.hour,format:function(n){return n.TimeHour}},{label:alsglance.resources.muscle,format:function(n){return n.MuscleAbbreviation}},"AUC"]).sortBy(function(n){return n.DateDate});dc.renderAll();$(".loading").remove()}};$(function(){$(window).height()+100<$(document).height()&&$("#top-link-block").removeClass("hidden").affix({offset:{top:100}});$("#version").text("(crossfilter: "+crossfilter.version+", d3: "+d3.version+", dc: "+dc.version+(window.Dygraph!=null?", dygraph: "+Dygraph.VERSION:"")+", moment: "+moment.version+")")});Date.prototype.setISO8601=function(n){var t=n.match(new RegExp("([0-9]{4})(-([0-9]{2})(-([0-9]{2})(T([0-9]{2}):([0-9]{2})(:([0-9]{2})(.([0-9]+))?)?(Z|(([-+])([0-9]{2}):([0-9]{2})))?)?)?)?")),r=0,i=new Date(t[1],0,1),u;t[3]&&i.setMonth(t[3]-1);t[5]&&i.setDate(t[5]);t[7]&&i.setHours(t[7]);t[8]&&i.setMinutes(t[8]);t[10]&&i.setSeconds(t[10]);t[12]&&i.setMilliseconds(Number("0."+t[12])*1e3);t[14]&&(r=(Number(t[16])*60+Number(t[17]))*(t[15]=="-"?1:-1));r-=i.getTimezoneOffset();u=Number(i)+r*6e4;this.setTime(Number(u))};
//# sourceMappingURL=alsglance.min.js.map
